# APIs for ZeptoWatch Scripts

---

0. `PikaScript` (Subset of Python3)

- 

1. `PikaStdLib` (Package, Recommend: `import PikaStdLib as std`)

- 

2. `ZeptoWatchStdLib` (Package, Recommend: `import ZeptoWatchStdLib as zws`)

```python
class System:
    def delayMs(self, time: int): ...
    # 用 FreeRTOS 的 osDelay 实现, 调用它以允许其它任务并行


class Display:
    def getField(self) -> lv_obj: ...
    # 获取应用界面屏幕的对象, 创建 lvgl 对象时作为根对象, 退出应用时会被清空.
    # 不建议使用 pika_lvgl.scr_act(), 如果在应用界面进入下拉栏时调用会导致组件显示到下拉栏.
    # 总之就是创建最初一级 UI 对象时用到, 例如: lb = lv.label(zws.Display.getField()).
    # 上例中利用 lv.label() 创建 label 对象, 使用 getField 获取应用页面作为其父对象.
    
    def setBrightness(self, val: int): ... 
    # 设置屏幕亮度, 值为 [0, 100].
    # 已经经过映射, 也就是 0 不代表彻底熄灭, 且亮暗变化更连续些.
    
    def getBrightness(self) -> int: ...
    # 获取当前屏幕亮度, 按键熄屏导致的亮度变化不算.


class Clock:
    def getHours(self) -> int: ...
    def getMinutes(self) -> int: ...
    def getSeconds(self) -> int: ...
    def getYear(self) -> int: ...
    def getMonth(self) -> int: ...
    def getDay(self) -> int: ...
    def getWeekDay(self) -> int: ...
    # 以上分别为获取实时时钟的时、分、秒、年、月、日、星期.
```

3. `ZeptoWatchPeriphLib` (Package, Recommend: `import ZeptoWatchPeriphLib as zwp`)

```python
class IMU:
    def initialize(self): ...
    # 初始化 IMU, 使用 IMU 前调用. 不过系统开机时自动初始化了, 可以不管.
    
    def getTemperature(self) -> int: ...
    # 获取温度原始值, 好像为温度值乘 100 后的结果.
    
    def getGyroscope(self) -> list: ...
    # 获取三轴角加速度, 返回一个三元素列表.
    # [-32768, 32767] 对应 [-2000dps, 2000dps], dps: degree per second.
    
    def getAccelerometer(self) -> list: ...
    # 获取三轴加速度, 返回一个三元素列表.
    # [-32768, 32767] 对应 [-2g, 2g].


class Battery:
    def isCharging(self) -> int: ...
    # 获取 Type-C 口是否接上电源.
    
    def getRawData(self) -> int: ...
    # 获取电池 ADC 采样原始值, 不准得很, 忽略吧.


class Microphone:
    def startSampling(self): ...
    # 开启麦克风采样, 使用前要调用.
    
    def stopSampling(self): ...
    # 停止麦克风采样.

    def getRawData(self) -> int: ...
    # 获取麦克风当前采样值.


class Vibrator:
    def vibrate(self, ms: int, pulse: int): ...
    # 振动马达振动, 持续 ms 毫秒, 占空比 pulse. 虽然效果不太舒适的样子.
    # 这玩意快能当蜂鸣器了 ...

    def stop(self): ...
    # 强制停止振动.
```

4. `pika_lvgl` (Package, Recommend: `import pika_lvgl as lv`)

东西很多, 可以去下个 Squareline Studio 鼠标点点看, 都是和 API 对应的. 当然, 简单能用的界面就用 label 和 btn 也足够了.

- `lv_obj`, 所有 lvgl 对象的父类, 挑一些注释一下.

```python
class lv_obj:
    def __init__(self, parent: lv_obj): ...
    
    def add_state(self, state: int): ...
    # 添加 state, 可取值见后 STATE.
    
    def add_flag(self, flag: int): ...
    def clear_flag(self, flag: int): ...
    # 添加或清除 flag, 例如隐藏等, 具体见后 flag_t
    
    def add_event_cb(self, event_cb: any, filter: int, user_data: pointer): ...
    # 添加回调函数. 例如: btn.add_event_cb(event_cb_btn, lv.EVENT.CLICKED, 0).
    # 上例为按钮添加了点击事件, btn 若被点击就会执行 event_cb_btn(e) 函数, 并传入一个 lv_event 参数.
    # lv_event 和 EVENT 可取值见后.
    
    def add_style(self, style: style_t, selector: int): ...
    # 添加样式, 见后 style_t.
    
    def set_pos(self, x: int, y: int): ...
    def set_x(self, x: int): ...
    def set_y(self, y: int): ...
    def set_size(self, w: int, h: int): ...
    def refr_size(self) -> int: ...
    def set_width(self, w: int): ...
    def set_height(self, h: int): ...
    def set_content_width(self, w: int): ...
    def set_content_height(self, h: int): ...
    # 各种设置大小、位置的 API.
    
    def set_layout(self, layout: int): ...
    def is_layout_positioned(self) -> int: ...
    def mark_layout_as_dirty(self): ...
    def update_layout(self): ...
    # 关于 Layout 的.
    
    def set_align(self, align: int): ...
    def align(self, align: int, x_ofs: int, y_ofs: int): ...
    def align_to(self, base: lv_obj, align: int, x_ofs: int, y_ofs: int): ...
    def center(self): ...
    # 关于对齐的, ALIGN 也见后. 前面设置坐标的基准是 ALIGN.
    # 例如: 如果设置为 lv.ALIGN.CENTER, 则正中间为坐标原点 (0,0).
    
    def get_x(self) -> int: ...
    def get_x2(self) -> int: ...
    def get_y(self) -> int: ...
    def get_y2(self) -> int: ...
    def get_x_aligned(self) -> int: ...
    def get_y_aligned(self) -> int: ...
    def get_width(self) -> int: ...
    def get_height(self) -> int: ...
    def get_content_width(self) -> int: ...
    def get_content_height(self) -> int: ...
    def get_self_width(self) -> int: ...
    def get_self_height(self) -> int: ...
    # 尺寸和位置参数的获取
    
    def refresh_self_size(self) -> int: ...
    def refr_pos(self): ...
    def move_to(self, x: int, y: int): ...
    def move_children_by(self, x_diff: int, y_diff: int, ignore_floating: int): ..
    def transform_point(self, p: point_t, recursive: int, inv: int): ...
    def invalidate(self): ...
    # 没用过不知道
    
    def is_visible(self) -> int: ...
    # 是否可见
    
    def set_ext_click_area(self, size: int): ...
    def hit_test(self, point: point_t) -> int: ...
    # 关于点击
    
    def set_flex_flow(self, flow: int): ...
    def set_flex_grow(self, value: int): ...
    def set_flex_align(self, main_place: int, cross_place: int, align: int): ...
    # 关于 Flex
    
    def set_id(self, id: str): ...
    def get_id(self) -> str: ...
    # 关于 id 的设置. 这个可以用来给同类组件打标签, 方便事件回调识别.
    # 例如计算器的例程中 16 个按钮分别 set_id 了各自的 id,
    # 这样在回调中就可以利用 e.get_target().get_id() 来识别是哪个按钮被点击了.
    
    def clean(self): ...
    # 清理子组件
```

- `label`, 标签, 首先继承 lv_obj, 也就是以上 lv_obj 里的方法都有, 其次还有以下成员:

```python
class label(lv_obj):
    def __init__(self, parent: lv_obj): ...
    
    def set_text(self, txt: str): ...
    # 设置标签的文字内容, 最常用.
    
    def set_long_mode(self, mode: int): ...
    def set_recolor(self, en: int): ...
    def set_style_text_align(self, value: int, selector: int): ...
```

- `btn`, 按钮, 啥也没封装, 全靠 lv_obj 的成员.

```python
class btn(lv_obj):
    def __init__(self, parent: lv_obj): ...
```

- 其它诸如 `bar`, `checkbox`, `dropdown`, `roller`, `slider`, `switch`, `table`, `img`, `textarea`, `arc` 等控件, 不包含 lvgl 所有控件, 例如 `panel` 和 `chart` 好像就没有, 但基本都全了. **具体可见** `Firmware/Libraries/PikaScript/pika_lvgl.pyi`, 包括其它库的定义也在该目录.

**下面是一些参数数据类型的定义:**

- `STATE`, state 的取值. 例如可以设置按钮的显示状态是普通还是按下之类.

```python
class STATE:
    DEFAULT: int
    CHECKED: int
    FOCUSED: int
    FOCUS_KEY: int
    EDITED: int
    HOVERED: int
    PRESSED: int
    SCROLLED: int
    DISABLED: int
    USER_1: int
    USER_2: int
    USER_3: int
    USER_4: int
    ANY: int
    def __init__(self): ...
```

- `flag_t`, flag 的取值. 例如 add_flag 添加下面第一个 HIDDEN 可以隐藏对象.

```python
class flag_t:
    HIDDEN: int
    CLICKABLE: int
    CLICK_FOCUSABLE: int
    CHECKABLE: int
    SCROLLABLE: int
    SCROLL_ELASTIC: int
    SCROLL_MOMENTUM: int
    SCROLL_ONE: int
    SCROLL_CHAIN_HOR: int
    SCROLL_CHAIN_VER: int
    SCROLL_CHAIN: int
    SCROLL_ON_FOCUS: int
    SCROLL_WITH_ARROW: int
    SNAPPABLE: int
    PRESS_LOCK: int
    EVENT_BUBBLE: int
    GESTURE_BUBBLE: int
    ADV_HITTEST: int
    IGNORE_LAYOUT: int
    FLOATING: int
    OVERFLOW_VISIBLE: int
    LAYOUT_1: int
    LAYOUT_2: int
    WIDGET_1: int
    WIDGET_2: int
    USER_1: int
    USER_2: int
    USER_3: int
    USER_4: int
    def __init__(self): ...
```

- `lv_event`, 回调函数可获取的信息.

```python
class lv_event:
    def get_code(self) -> int: ... # 获取事件类型
    def get_target(self) -> lv_obj: ... # 获取触发事件的对象
```

- `EVENT`, 可添加的事件类型. 需在回调函数中条件判断事件类型. 例如:
```python
def event_cb_btn(e):
    code = e.get_code() # 见 lv_event, 获取事件类型
    if code == lv.EVENT.CLICKED:
        pass
```

```python
class EVENT:
    ALL: int
    PRESSED: int
    PRESSING: int
    PRESS_LOST: int
    SHORT_CLICKED: int
    LONG_PRESSED: int
    LONG_PRESSED_REPEAT: int
    CLICKED: int
    RELEASED: int
    SCROLL_BEGIN: int
    SCROLL_END: int
    SCROLL: int
    GESTURE: int
    KEY: int
    FOCUSED: int
    DEFOCUSED: int
    LEAVE: int
    HIT_TEST: int
    COVER_CHECK: int
    REFR_EXT_DRAW_SIZE: int
    DRAW_MAIN_BEGIN: int
    DRAW_MAIN: int
    DRAW_MAIN_END: int
    DRAW_POST_BEGIN: int
    DRAW_POST: int
    DRAW_POST_END: int
    DRAW_PART_BEGIN: int
    DRAW_PART_END: int
    VALUE_CHANGED: int
    INSERT: int
    REFRESH: int
    READY: int
    CANCEL: int
    DELETE: int
    CHILD_CHANGED: int
    CHILD_CREATED: int
    CHILD_DELETED: int
    SCREEN_UNLOAD_START: int
    SCREEN_LOAD_START: int
    SCREEN_LOADED: int
    SCREEN_UNLOADED: int
    SIZE_CHANGED: int
    STYLE_CHANGED: int
    LAYOUT_CHANGED: int
    GET_SELF_SIZE: int
    PREPROCESS: int
    def __init__(self): ...
```

- `style_t`, style 相关. 建立 style_t 的实例后传入 add_style.

```python
class style_t:
    def __init__(self): ...
    def init(self): ...
    def set_width(self, value: int): ...
    def set_min_width(self, value: int): ...
    def set_max_width(self, value: int): ...
    def set_height(self, value: int): ...
    def set_min_height(self, value: int): ...
    def set_max_height(self, value: int): ...
    def set_x(self, value: int): ...
    def set_y(self, value: int): ...
    def set_align(self, value: int): ...
    def set_transform_width(self, value: int): ...
    def set_transform_height(self, value: int): ...
    def set_translate_x(self, value: int): ...
    def set_translate_y(self, value: int): ...
    def set_transform_zoom(self, value: int): ...
    def set_transform_angle(self, value: int): ...
    def set_transform_pivot_x(self, value: int): ...
    def set_transform_pivot_y(self, value: int): ...
    def set_pad_top(self, value: int): ...
    def set_pad_bottom(self, value: int): ...
    def set_pad_left(self, value: int): ...
    def set_pad_right(self, value: int): ...
    def set_pad_row(self, value: int): ...
    def set_pad_column(self, value: int): ...
    def set_bg_color(self, value: lv_color_t): ...
    def set_bg_opa(self, value: int): ...
    def set_bg_grad_color(self, value: lv_color_t): ...
    def set_bg_grad_dir(self, value: int): ...
    def set_bg_main_stop(self, value: int): ...
    def set_bg_grad_stop(self, value: int): ...
    def set_bg_dither_mode(self, value: int): ...
    def set_bg_img_src(self, value: bytes): ...
    def set_bg_img_opa(self, value: int): ...
    def set_bg_img_recolor(self, value: lv_color_t): ...
    def set_bg_img_recolor_opa(self, value: int): ...
    def set_bg_img_tiled(self, value: int): ...
    def set_border_color(self, value: lv_color_t): ...
    def set_border_opa(self, value: int): ...
    def set_border_width(self, value: int): ...
    def set_border_side(self, value: int): ...
    def set_border_post(self, value: int): ...
    def set_outline_width(self, value: int): ...
    def set_outline_color(self, value: lv_color_t): ...
    def set_outline_opa(self, value: int): ...
    def set_outline_pad(self, value: int): ...
    def set_shadow_width(self, value: int): ...
    def set_shadow_ofs_x(self, value: int): ...
    def set_shadow_ofs_y(self, value: int): ...
    def set_shadow_spread(self, value: int): ...
    def set_shadow_color(self, value: lv_color_t): ...
    def set_shadow_opa(self, value: int): ...
    def set_img_opa(self, value: int): ...
    def set_img_recolor(self, value: lv_color_t): ...
    def set_img_recolor_opa(self, value: int): ...
    def set_line_width(self, value: int): ...
    def set_line_dash_width(self, value: int): ...
    def set_line_dash_gap(self, value: int): ...
    def set_line_rounded(self, value: int): ...
    def set_line_color(self, value: lv_color_t): ...
    def set_line_opa(self, value: int): ...
    def set_arc_width(self, value: int): ...
    def set_arc_rounded(self, value: int): ...
    def set_arc_color(self, value: lv_color_t): ...
    def set_arc_opa(self, value: int): ...
    def set_arc_img_src(self, value: bytes): ...
    def set_text_color(self, value: lv_color_t): ...
    def set_text_opa(self, value: int): ...
    def set_text_letter_space(self, value: int): ...
    def set_text_line_space(self, value: int): ...
    def set_text_decor(self, value: int): ...
    def set_text_align(self, value: int): ...
    def set_radius(self, value: int): ...
    def set_clip_corner(self, value: int): ...
    def set_opa(self, value: int): ...
    def set_color_filter_opa(self, value: int): ...
    def set_anim_time(self, value: int): ...
    def set_anim_speed(self, value: int): ...
    def set_blend_mode(self, value: int): ...
    def set_layout(self, value: int): ...
    def set_base_dir(self, value: int): ...
    def reset(self): ...
    def register_prop(self, flag: int) -> int: ...
    def get_num_custom_props(self) -> int: ...
    def remove_prop(self, prop: int) -> int: ...
    def is_empty(self) -> int: ...
    def set_size(self, value: int): ...
    def set_pad_all(self, value: int): ...
    def set_pad_hor(self, value: int): ...
    def set_pad_ver(self, value: int): ...
    def set_pad_gap(self, value: int): ...
    def prop_has_flag(self, prop: int, flag: int) -> int: ...
    def set_flex_flow(self, value: int): ...
    def set_flex_main_place(self, value: int): ...
    def set_flex_cross_place(self, value: int): ...
    def set_flex_track_place(self, value: int): ...
    def set_flex_grow(self, value: int): ...
```

- `ALIGN`, align 的取值.

```python
class ALIGN:
    DEFAULT: int
    TOP_LEFT: int
    TOP_MID: int
    TOP_RIGHT: int
    BOTTOM_LEFT: int
    BOTTOM_MID: int
    BOTTOM_RIGHT: int
    LEFT_MID: int
    RIGHT_MID: int
    CENTER: int
    OUT_TOP_LEFT: int
    OUT_TOP_MID: int
    OUT_TOP_RIGHT: int
    OUT_BOTTOM_LEFT: int
    OUT_BOTTOM_MID: int
    OUT_BOTTOM_RIGHT: int
    OUT_LEFT_TOP: int
    OUT_LEFT_MID: int
    OUT_LEFT_BOTTOM: int
    OUT_RIGHT_TOP: int
    OUT_RIGHT_MID: int
    OUT_RIGHT_BOTTOM: int
    def __init__(self): ...
```

---
